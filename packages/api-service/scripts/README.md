# 数据清理脚本使用说明

## clean-old-templates.ts - 清理旧模板数据

### 功能说明

清理所有 `name` 字段为英文标识符格式的旧模板数据。

**判断标准：** `name` 字段不包含中文字符的记录将被删除。

### 使用方法

#### 1. 预览模式（推荐先执行）

查看将要删除的数据，但不实际删除：

```bash
cd packages/api-service
pnpm clean:templates:dry
```

或：

```bash
pnpm --filter @webbox/api-service clean:templates:dry
```

#### 2. 实际删除

确认无误后，执行实际删除：

```bash
cd packages/api-service
pnpm clean:templates
```

或：

```bash
pnpm --filter @webbox/api-service clean:templates
```

### 参数说明

- `--dry-run`: 只显示将要删除的数据，不实际删除（安全模式）
- `--verbose`: 显示详细的删除记录（包含每条记录的 ID 和 name）

### 输出示例

#### 预览模式输出

```
==========================================
         模板数据清理脚本
==========================================

⚠️  运行模式: DRY-RUN (只查看，不删除)

[清理脚本] 连接数据库: mongodb://localhost:27017/webbox
[清理脚本] 数据库连接成功

========== 开始清理基础模板 ==========
[基础模板] 总数: 5
[基础模板] 脏数据: 2

[基础模板] 将要删除的记录:
  1. ID: 507f1f77bcf86cd799439011, Name: "privacy-policy-template", Category: policy
  2. ID: 507f191e810c19729de860ea, Name: "terms-of-service", Category: terms

[基础模板] [DRY-RUN] 将删除 2 条记录（实际未删除）

========== 开始清理自定义模板 ==========
[自定义模板] 总数: 3
[自定义模板] 脏数据: 1

[自定义模板] 将要删除的记录:
  1. ID: 507f1f77bcf86cd799439012, Name: "custom-policy-v1", Status: draft

[自定义模板] [DRY-RUN] 将删除 1 条记录（实际未删除）

========== 清理完成 ==========
[汇总] 共发现 3 条脏数据（DRY-RUN 模式，未实际删除）
  - 基础模板: 2 条
  - 自定义模板: 1 条

💡 提示：移除 --dry-run 参数可实际执行删除操作
```

#### 实际删除输出

```
==========================================
         模板数据清理脚本
==========================================

⚠️  运行模式: 实际删除

[清理脚本] 连接数据库: mongodb://localhost:27017/webbox
[清理脚本] 数据库连接成功

========== 开始清理基础模板 ==========
[基础模板] 总数: 5
[基础模板] 脏数据: 2

[基础模板] ✅ 已删除 2 条记录

========== 开始清理自定义模板 ==========
[自定义模板] 总数: 3
[自定义模板] 脏数据: 1

[自定义模板] ✅ 已删除 1 条记录

========== 清理完成 ==========
[汇总] 共清理 3 条脏数据
  - 基础模板: 2 条
  - 自定义模板: 1 条

✨ 清理成功！
```

### 注意事项

1. **先执行预览模式**：建议先使用 `--dry-run` 参数查看将要删除的数据
2. **备份数据库**：重要数据请先备份
3. **确认环境**：确保 `MONGODB_URI` 环境变量指向正确的数据库
4. **删除不可逆**：删除操作不可逆，请谨慎操作

### 环境变量

确保设置了正确的数据库连接：

```bash
export MONGODB_URI=mongodb://localhost:27017/webbox
```

或在 `.env` 文件中配置：

```env
MONGODB_URI=mongodb://localhost:27017/webbox
```
